<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Editar Perfil - MediPlus</title>
</head>
<body>
    <h2>Editar Perfil</h2>
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for m in messages %}<div style="color:green">{{ m }}</div>{% endfor %}
        {% endif %}
    {% endwith %}

    <form method="POST" action="{{ url_for('usuario.editar_usuario') }}" id="editForm">
        <label>Nombre</label><br>
        <input type="text" name="nombre" value="{{ usuario.nombre }}"><br>
        <label>Apellido</label><br>
        <input type="text" name="apellido" value="{{ usuario.apellido }}"><br>
        <label>Tel√©fono</label><br>
        <input type="text" name="telefono" value="{{ usuario.telefono }}"><br>
        <label>Email</label><br>
        <input type="email" name="email" value="{{ usuario.email }}"><br>
        <button type="submit">Guardar</button>
    </form>

    <script>
    document.getElementById('editForm').addEventListener('submit', function(e){
        e.preventDefault();
        const form = e.target;
        const data = {
            nombre: form.nombre.value,
            apellido: form.apellido.value,
            telefono: form.telefono.value,
            email: form.email.value
        };

        fetch(form.action, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        }).then(r => r.json()).then(j => {
            if (j.mensaje) location.reload();
            else alert('Error: ' + (j.error || JSON.stringify(j)));
        });
    });
    </script>
</body>
</html>